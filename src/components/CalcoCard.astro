---
import type { CollectionEntry } from 'astro:content';

interface Props {
  calco: CollectionEntry<'calcos'>;
}

const { calco } = Astro.props as Props;
const { name, price, image, payment_url } = calco.data;
const description = calco.body.replace(/\n+/g, ' ').trim();
const formattedDescription = description.length > 140 ? `${description.slice(0, 137)}...` : description;
const priceLabel = new Intl.NumberFormat('es-AR', {
  style: 'currency',
  currency: 'ARS',
  maximumFractionDigits: 0
}).format(price);
const base = import.meta.env.BASE_URL || '/';
const assetUrl = (path: string) => {
  if (/^https?:\/\//i.test(path) || path.startsWith('data:')) return path;
  return `${base}${path.replace(/^\//, '')}`;
};
const imageSrc = assetUrl(image);
---
<article class="bg-white border border-slate-200 rounded-2xl overflow-hidden shadow-sm flex flex-col">
  <img src={imageSrc} alt={`Calco ${name}`} class="h-48 w-full object-cover" loading="lazy" />
  <div class="flex-1 flex flex-col gap-4 p-5">
    <header class="space-y-1">
      <h3 class="text-lg font-semibold text-primary">{name}</h3>
      <p class="text-sm text-slate-500 leading-relaxed">{formattedDescription}</p>
    </header>
    <div class="mt-auto flex items-center justify-between">
      <span class="text-xl font-bold text-accent">{priceLabel}</span>
      <a
        href={payment_url}
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 rounded-full bg-primary px-4 py-2 text-sm font-semibold text-white hover:bg-slate-900"
      >
        Comprar
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-4">
          <path d="M13.5 5.25H18.75V10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
          <path d="M5.25 18.75L18.75 5.25" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        </svg>
      </a>
    </div>
  </div>
</article>
