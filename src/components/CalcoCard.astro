---
interface Calco {
  id: string;
  name: string;
  price: number;
  image: string;
  description: string;
  category: string;
}

const { calco } = Astro.props as { calco: Calco };
const rawBase = import.meta.env.BASE_URL || '/';
const normalizedBase = rawBase.endsWith('/') ? rawBase : `${rawBase}/`;
const withBase = (path: string) => {
  if (!path) return '';
  if (/^https?:\/\//i.test(path)) return path;
  const trimmed = path.startsWith('/') ? path.slice(1) : path;
  return `${normalizedBase}${trimmed}`;
};
const isAbsolute = /^https?:\/\//i.test(calco.image) || calco.image.startsWith('data:');
const imageSrc = isAbsolute ? calco.image : withBase(calco.image);
const priceLabel = new Intl.NumberFormat('es-AR', {
  style: 'currency',
  currency: 'ARS',
  maximumFractionDigits: 0
}).format(calco.price);
---
<article
  class="flex flex-col overflow-hidden rounded-[32px] border border-white/70 bg-white/90 shadow-lg shadow-slate-200/40 transition hover:-translate-y-1 hover:shadow-xl"
  data-product-card
  data-id={calco.id}
  data-name={calco.name}
  data-price={calco.price}
  data-image={calco.image}
  data-category={calco.category}
  data-qty="1"
>
  <figure class="relative bg-brand-soft">
    <img src={imageSrc} alt={`Calco ${calco.name}`} class="h-64 w-full object-contain p-6" loading="lazy" />
    <figcaption class="absolute left-6 top-6 rounded-full bg-white/90 px-4 py-1 text-xs font-semibold uppercase tracking-widest text-slate-600 shadow">
      {calco.category}
    </figcaption>
  </figure>
  <div class="flex flex-1 flex-col gap-4 p-6">
    <header class="space-y-1">
      <h3 class="text-2xl font-semibold text-slate-900">{calco.name}</h3>
      <p class="text-sm leading-relaxed text-slate-600">{calco.description}</p>
    </header>
    <div class="mt-auto space-y-3">
      <div class="flex items-center justify-between">
        <span class="text-3xl font-bold text-accent">{priceLabel}</span>
        <div class="flex items-center gap-2 rounded-full bg-slate-100 px-3 py-1.5">
          <button
            type="button"
            class="h-8 w-8 rounded-full bg-white text-lg font-semibold text-accent shadow hover:bg-slate-100"
            data-action="dec"
            aria-label={`Restar ${calco.name}`}
          >
            -
          </button>
          <span class="w-8 text-center font-semibold text-slate-900" data-qty>1</span>
          <button
            type="button"
            class="h-8 w-8 rounded-full bg-primary text-lg font-semibold text-white shadow hover:bg-accent"
            data-action="inc"
            aria-label={`Sumar ${calco.name}`}
          >
            +
          </button>
        </div>
      </div>
      <button
        type="button"
        class="inline-flex w-full items-center justify-center rounded-2xl bg-primary px-4 py-3 text-base font-semibold text-white shadow-lg shadow-primary/40 hover:bg-accent"
        data-action="add"
      >
        Agregar
      </button>
    </div>
  </div>
</article>
