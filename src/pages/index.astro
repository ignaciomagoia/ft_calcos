---
import { readFile } from 'node:fs/promises';
import BaseLayout from '../layouts/BaseLayout.astro';
import CalcoCard from '../components/CalcoCard.astro';
import { categories } from '../data/categories';

const dataFile = new URL('../../public/data/calcos.json', import.meta.url);
const catalogData = JSON.parse(await readFile(dataFile, 'utf-8'));
const catalog = [...catalogData].sort((a, b) => a.name.localeCompare(b.name));
const rawBase = import.meta.env.BASE_URL || '/';
const basePrefix = rawBase === '/' ? '' : rawBase.replace(/\/$/, '');
const toBasePath = (path: string) => `${basePrefix}${path.startsWith('/') ? path : `/${path}`}` || '/';

const heroImages = catalog.slice(0, 3).map((item) => ({
  ...item,
  imageSrc: toBasePath(item.image)
}));

const categoryCards = categories.map((category) => ({
  ...category,
  imageSrc: toBasePath(category.image),
  href: toBasePath(`/categorias/${category.slug}`)
}));
---
<BaseLayout title="Catalogo | FT Calcos" description="Catalogo de calcos personalizados listos para imprimir.">
    <section class="space-y-8 text-center md:text-left">
    <div class="inline-flex items-center justify-center rounded-[36px] bg-white/90 p-4 shadow-lg shadow-slate-200/70 ring-1 ring-white/70">
      <img src={toBasePath('/images/logovariante.png')} alt="Efete Calcos" class="h-20 w-auto object-contain" loading="lazy" />
    </div>
    <p class="text-sm font-semibold uppercase tracking-[0.4em] text-accent">Nueva temporada</p>
    <h1 class="text-4xl sm:text-5xl lg:text-6xl font-black text-slate-900 leading-tight">Pega tu estilo</h1>
    
    <div class="flex flex-col gap-3 sm:flex-row sm:items-center justify-center md:justify-start">
      <a href="#catalogo" class="rounded-full bg-primary px-8 py-3 text-center text-white text-base font-semibold shadow-lg shadow-primary/30 hover:bg-accent transition-colors">
        Ver catalogo
      </a>
      <span class="text-xs uppercase tracking-[0.25em] text-accent">envios a todo el pais</span>
    </div>
  </section>


  <section class="mt-16 space-y-6">
    <div class="flex flex-col gap-2">
      <p class="text-xs uppercase tracking-[0.4em] text-slate-400">categorias</p>
      <h2 class="text-3xl font-bold text-slate-900">Explora por tipo de calco</h2>
      <p class="text-slate-600">Hace clic y te llevamos directo al catálogo filtrado de esa categoria.</p>
    </div>
    <div class="grid grid-cols-2 gap-3 sm:grid-cols-2 lg:grid-cols-3 max-w-3xl mx-auto">
      {categoryCards.map((category) => (
        <a
          href={category.href}
          class="flex w-full flex-col justify-between rounded-[28px] p-4 text-left text-white shadow-lg transition hover:-translate-y-1"
          style={`background:${category.gradient}`}
        >
          <div class="flex items-center gap-3">
            <img src={category.imageSrc} alt={category.label} class="h-20 w-20 rounded-3xl bg-white/20 p-2" loading="lazy" />
            <div>
              <p class="text-[0.55rem] uppercase tracking-[0.35em] text-white/80">Categoria</p>
              <h3 class="text-xl font-semibold">{category.label}</h3>
            </div>
          </div>
          <p class="mt-4 text-xs sm:text-sm text-white/90">{category.description}</p>
          <span class="mt-3 inline-flex items-center gap-2 text-xs sm:text-sm font-semibold">
            Ver productos
            <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M13 6l6 6-6 6" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </span>
        </a>
      ))}
    </div>
  </section>

  <section id="catalogo" class="mt-16">
    <div class="flex flex-col gap-1 sm:flex-row sm:items-end sm:justify-between mb-8">
      <div>
        <p class="text-xs uppercase tracking-[0.4em] text-slate-400">catalogo</p>
        <h2 class="text-3xl font-semibold text-slate-900">Elegí tu próximo calco</h2>
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400" data-active-filter>Todos los calcos</p>
      </div>
      <span class="text-sm text-slate-500">{catalog.length} diseños disponibles</span>
    </div>
    <div class="grid gap-8 sm:grid-cols-2 xl:grid-cols-3">
      {catalog.map((calco) => (
        <CalcoCard calco={calco} />
      ))}
    </div>
  </section>
</BaseLayout>
