---
import { readFile } from 'node:fs/promises';
import BaseLayout from '../layouts/BaseLayout.astro';
import CalcoCard from '../components/CalcoCard.astro';
import { categories } from '../data/categories';

const dataFile = new URL('../../public/data/calcos.json', import.meta.url);
const catalogData = JSON.parse(await readFile(dataFile, 'utf-8'));
const catalog = [...catalogData].sort((a, b) => a.name.localeCompare(b.name));
const rawBase = import.meta.env.BASE_URL || '/';
const basePrefix = rawBase === '/' ? '' : rawBase.replace(/\/$/, '');
const toBasePath = (path: string) => `${basePrefix}${path.startsWith('/') ? path : `/${path}`}` || '/';

const heroImages = catalog.slice(0, 3).map((item) => ({
  ...item,
  imageSrc: toBasePath(item.image)
}));

const categoryCards = categories.map((category) => ({
  ...category,
  imageSrc: toBasePath(category.image),
  href: toBasePath(`/categorias/${category.slug}`)
}));
---
<BaseLayout title="Catalogo | FT Calcos" description="Catalogo de calcos personalizados listos para imprimir.">
  <section class="grid gap-10 lg:grid-cols-[1.1fr_0.9fr] items-center">
    <div class="space-y-6">
      <img src={toBasePath('/images/logovariante.png')} alt="Efete Calcos" class="h-20 w-auto" loading="lazy" />
      <p class="text-sm font-semibold uppercase tracking-[0.4em] text-accent">Nueva temporada</p>
      <h1 class="text-4xl sm:text-5xl lg:text-6xl font-black text-slate-900 leading-tight">Pega tu estilo</h1>
      <p class="text-lg text-slate-600 max-w-2xl">
        Stickers, vinilos y planchas listas para personalizar botellas, cuadernos, cascos y todo lo que imagines. Elegi tus diseños
        favoritos, agregalos al carrito y coordinemos por WhatsApp.
      </p>
      <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
        <a href="#catalogo" class="rounded-full bg-primary px-8 py-3 text-center text-white text-base font-semibold shadow-lg shadow-primary/30 hover:bg-accent transition-colors">
          Ver catalogo
        </a>
        <span class="text-sm uppercase tracking-[0.3em] text-slate-400">envios a todo el pais</span>
      </div>
    </div>
    <div class="relative">
      <div class="absolute inset-0 rounded-[32px] bg-gradient-to-br from-primary/30 to-accent/20 blur-2xl"></div>
      <div class="relative grid gap-4 rounded-[32px] border border-white/70 bg-white/80 p-6 shadow-xl backdrop-blur">
        <div class="flex justify-between text-xs uppercase tracking-[0.3em] text-slate-400">
          <span>galeria ft calcos</span>
          <span>coleccion 2025</span>
        </div>
        <div class="grid grid-cols-2 gap-4">
          {heroImages.map((item) => (
            <div class="rounded-3xl bg-brand-soft p-4 flex flex-col items-center gap-3 shadow-sm" key={item.id}>
              <img src={item.imageSrc} alt={item.name} class="h-28 w-full object-contain" loading="lazy" />
              <p class="text-sm font-semibold text-slate-900 text-center">{item.name}</p>
            </div>
          ))}
        </div>
        <p class="text-slate-500 text-sm">+{catalog.length} diseños listos para imprimir.</p>
      </div>
    </div>
  </section>

  <section class="mt-16 space-y-6">
    <div class="flex flex-col gap-2">
      <p class="text-xs uppercase tracking-[0.4em] text-slate-400">categorias</p>
      <h2 class="text-3xl font-bold text-slate-900">Explora por tipo de calco</h2>
      <p class="text-slate-600">Hace clic y te llevamos directo al catálogo filtrado de esa categoria.</p>
    </div>
    <div class="grid gap-4 md:grid-cols-2 xl:grid-cols-3">
      {categoryCards.map((category) => (
        <a
          href={category.href}
          class="flex w-full flex-col justify-between rounded-[32px] p-6 text-left text-white shadow-lg transition hover:-translate-y-1"
          style={`background:${category.gradient}`}
        >
          <div class="flex items-center gap-4">
            <img src={category.imageSrc} alt={category.label} class="h-24 w-24 rounded-3xl bg-white/20 p-3" loading="lazy" />
            <div>
              <p class="text-xs uppercase tracking-[0.4em] text-white/80">Categoria</p>
              <h3 class="text-2xl font-semibold">{category.label}</h3>
            </div>
          </div>
          <p class="mt-6 text-sm text-white/90">{category.description}</p>
          <span class="mt-4 inline-flex items-center gap-2 text-sm font-semibold">
            Ver productos
            <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M5 12h14M13 6l6 6-6 6" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </span>
        </a>
      ))}
    </div>
  </section>

  <section id="catalogo" class="mt-16">
    <div class="flex flex-col gap-1 sm:flex-row sm:items-end sm:justify-between mb-8">
      <div>
        <p class="text-xs uppercase tracking-[0.4em] text-slate-400">catalogo</p>
        <h2 class="text-3xl font-semibold text-slate-900">Elegí tu próximo calco</h2>
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-slate-400" data-active-filter>Todos los calcos</p>
      </div>
      <span class="text-sm text-slate-500">{catalog.length} diseños disponibles</span>
    </div>
    <div class="grid gap-8 sm:grid-cols-2 xl:grid-cols-3">
      {catalog.map((calco) => (
        <CalcoCard calco={calco} />
      ))}
    </div>
  </section>
</BaseLayout>
